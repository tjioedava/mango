{% extends 'base.html' %}
{% load static %}

{% block meta %}
    <meta name="csrf-token" content="{{ csrf_token }}">
    <link rel="stylesheet" href="{% static 'css/main/components/navigation-bar.css' %}">
    <link rel="stylesheet" href="{% static 'css/main/components/product-card.css' %}">
    <link rel="stylesheet" href="{% static 'css/main/home.css' %}">
    <title>Mango - Home</title>
{% endblock meta %}

{% block content %}
    <header>
        {% include 'components/navigation-bar.html' with title='Mango E-Commerce' %}
    </header>   
    <main>
        <div class="title-container"><h2>Products</h2></div>
        <div class="products"></div>
    </main>
    <script>
        async function getProducts(){
            let response = await fetch("/show-products");
            return response.json();
        }
        var innerHTMLString = ""
        getProducts().then((products) => {
            if (products.length == 0){
                innerHTMLString += `
                <div class="no-product">
                    <img src="static/images/empty-cardboard.png" alt="Empty Cardboard"/>
                    <p>No product has been created.</p>
                    <a href="/create-product"><div class="create-product-empty">Create Product</div></a>
                </div>`
            } else{
                const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute("content");
                innerHTMLString += `<div class="products-grid">`
                products.forEach((product) => {
                    innerHTMLString += `
                    <div class="product-card">
                        <div class="inner-container">
                            <div class="product-name">
                                <h2>${product.fields.name}</h2>
                            </div>
                            <div class="product-description">
                                <p>${product.fields.description}</p>
                            </div>
                            <div class="product-price">
                                <h3>\$${product.fields.price}</h3>
                            </div>
                            <div class="operation-container">
                                <a href="/edit-product/${product.pk}">
                                    <button><i class="fa-solid fa-pen-to-square"></i></button>
                                </a> 
                                <form action="/delete-product/${product.pk}" method="POST">
                                    <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
                                    <button><i class="fa-solid fa-trash"></i></button>
                                </form>
                            </div> 
                        </div>
                    </div>`
                });
                innerHTMLString += `<div class="create-product-existent" data-href="/create-product">+</div></div>`
            }
            document.querySelector('.products').innerHTML = innerHTMLString;
            const createProductExistentButton = document.querySelector('.create-product-existent');
            if (createProductExistentButton){
                createProductExistentButton.addEventListener('click', () => {
                    window.location.href = '/create-product';
                });
            }
        }).catch();
    </script>
{% endblock content %}